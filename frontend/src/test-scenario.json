{
  "sender": "{{ENV.SENDER_ADDRESS}}",
  "executionFee": "0.0001",
  "workflow": {
    "name": "real-estate-investment-submit-property-analysis",
    "version": "v1.0.0",
    "steps": [
      {
        "type": 10,
        "name": "property-data-fetcher",
        "image": "ghcr.io/krnl-labs/executor-http@sha256:07ef35b261014304a0163502a7f1dec5395c5cac1fc381dc1f79b052389ab0d5",
        "attestor": "image://ghcr.io/krnl-labs/attestor-poc-realestateinvestment-dapp:latest@sha256:5ab93c9c06d64333ecd19a47bafc3348bb14e2b2ffd2972ab93044509fab1857",
        "next": "market-data-fetcher",
        "config": {},
        "inputs": {
          "url": "https://poc.platform.lat/zillow/webservice/GetSearchResults.htm?zws-id=demo-api-key&address={{PROPERTY_ADDRESS}}&citystatezip={{CITY_STATE_ZIP}}",
          "method": "GET"
        },
        "outputs": [
          {
            "name": "zpid",
            "value": "response.body.searchResults.zpid",
            "required": true,
            "export": true
          },
          {
            "name": "address.street",
            "value": "response.body.searchResults.address.street",
            "required": true,
            "export": true
          },
          {
            "name": "address.zipcode",
            "value": "response.body.searchResults.address.zipcode",
            "required": true,
            "export": true
          },
          {
            "name": "address.city",
            "value": "response.body.searchResults.address.city",
            "required": true,
            "export": true
          },
          {
            "name": "address.state",
            "value": "response.body.searchResults.address.state",
            "required": true,
            "export": true
          }
        ]
      },
      {
        "name": "market-data-fetcher",
        "image": "ghcr.io/krnl-labs/executor-http@sha256:07ef35b261014304a0163502a7f1dec5395c5cac1fc381dc1f79b052389ab0d5",
        "attestor": "image://ghcr.io/krnl-labs/attestor-poc-realestateinvestment-dapp:latest@sha256:5ab93c9c06d64333ecd19a47bafc3348bb14e2b2ffd2972ab93044509fab1857",
        "next": "ai-property-analysis",
        "config": {},
        "inputs": {
          "url": "https://poc.platform.lat/zillow/webservice/GetZestimate.htm?zws-id=demo-api-key&zpid=${property-data-fetcher.zpid}",
          "method": "GET"
        },
        "outputs": [
          {
            "name": "zestimate.amount.value",
            "value": "response.body.zestimate.amount.value",
            "required": true,
            "export": true
          },
          {
            "name": "zestimate.amount.currency",
            "value": "response.body.zestimate.amount.currency",
            "required": true,
            "export": true
          },
          {
            "name": "zestimate.rent.value",
            "value": "response.body.zestimate.rentZestimate.value",
            "required": true,
            "export": true
          },
          {
            "name": "zestimate.rent.currency",
            "value": "response.body.zestimate.rentZestimate.currency",
            "required": true,
            "export": true
          },
          {
            "name": "property.bedrooms",
            "value": "response.body.property.bedrooms",
            "required": true,
            "export": true
          },
          {
            "name": "property.bathrooms",
            "value": "response.body.property.bathrooms",
            "required": true,
            "export": true
          },
          {
            "name": "property.finishedSqFt",
            "value": "response.body.property.finishedSqFt",
            "required": true,
            "export": true
          },
          {
            "name": "property.yearBuilt",
            "value": "response.body.property.yearBuilt",
            "required": true,
            "export": true
          },
          {
            "name": "property.type",
            "value": "response.body.property.propertyType",
            "required": true,
            "export": true
          }
        ]
      },
      {
        "name": "ai-property-analysis",
        "image": "ghcr.io/krnl-labs/executor-http@sha256:07ef35b261014304a0163502a7f1dec5395c5cac1fc381dc1f79b052389ab0d5",
        "attestor": "image://ghcr.io/krnl-labs/attestor-poc-realestateinvestment-dapp:latest@sha256:5ab93c9c06d64333ecd19a47bafc3348bb14e2b2ffd2972ab93044509fab1857",
        "next": "construct-property-analysis-evm",
        "config": {},
        "inputs": {
          "url": "https://poc.platform.lat/openai/openai-api?poc=property-analysis",
          "method": "GET",
          "headers": {
            "Accept": "*/*",
            "Content-Type": "application/json",
            "Authorization": "Bearer ${_SECRETS.OPENAI_API_KEY}"
          },
          "body": {
            "model": "gpt-4o-mini",
            "temperature": 0,
            "response_format": {
              "type": "json_object"
            },
            "messages": [
              {
                "role": "system",
                "content": "You are a professional real estate analyst. Only output valid JSON."
              },
              {
                "role": "user",
                "content": "You are a professional real estate investment analyst with 15 years of experience. You analyze property data objectively and provide structured investment recommendations. Analyze this property for investment potential. Property: ${property-data-fetcher.address.street}, ${property-data-fetcher.address.city}, ${property-data-fetcher.address.state} ${property-data-fetcher.address.zipcode}. With bedrooms: ${market-data-fetcher.property.bedrooms}, bathrooms: ${market-data-fetcher.property.bathrooms}, finished square feet: ${market-data-fetcher.property.finishedSqFt}, year built: ${market-data-fetcher.property.yearBuilt}, type: ${market-data-fetcher.property.type}. Zillow Estimate: ${market-data-fetcher.zestimate.amount.value}(${market-data-fetcher.zestimate.amount.currency}). Monthly rent Zillow estimate: ${market-data-fetcher.zestimate.rent.value}(${market-data-fetcher.zestimate.rent.currency}). Return analysis in this exact JSON format: { recommendation: INVEST/HOLD/PASS, property_value: number*10^20, investment_grade: A+/A/B+/B/C+/C/D, expected_annual_yield: number*10^18, confidence: number (1-100), invest_value: number * 10^18 }. Always return valid JSON in the exact format requested."
              }
            ]
          },
          "timeout": 30
        },
        "outputs": [
          {
            "name": "result",
            "value": "response.body.choices.0.message.content",
            "type": "json",
            "required": true,
            "export": true
          }
        ]
      },
      {
        "name": "construct-property-analysis-evm",
        "image": "ghcr.io/krnl-labs/executor-encoder-evm@sha256:b28823d12eb1b16cbcc34c751302cd2dbe7e35480a5bc20e4e7ad50a059b6611",
        "attestor": "image://ghcr.io/krnl-labs/attestor-poc-realestateinvestment-dapp:latest@sha256:5ab93c9c06d64333ecd19a47bafc3348bb14e2b2ffd2972ab93044509fab1857",
        "next": "prepare-authdata",
        "config": {
          "parameters": [
            {
              "name": "propertyInfo",
              "type": "tuple",
              "components": [
                {
                  "name": "confidence",
                  "type": "uint256"
                },
                {
                  "name": "expectedAnnualYield",
                  "type": "uint256"
                },
                {
                  "name": "investmentGrade",
                  "type": "string"
                },
                {
                  "name": "propertyValue",
                  "type": "uint256"
                },
                {
                  "name": "recommendation",
                  "type": "string"
                }
              ]
            }
          ]
        },
        "inputs": {
          "value": {
            "propertyInfo": {
              "confidence": "${ai-property-analysis.result.confidence}",
              "expectedAnnualYield": "${ai-property-analysis.result.expected_annual_yield}",
              "investmentGrade": "${ai-property-analysis.result.investment_grade}",
              "propertyValue": "70000000000000000000000",
              "recommendation": "${ai-property-analysis.result.recommendation}"
            }
          }
        },
        "outputs": [
          {
            "name": "result",
            "value": "result",
            "required": true,
            "export": true
          }
        ]
      },
      {
        "name": "prepare-authdata",
        "image": "ghcr.io/krnl-labs/executor-prepare-authdata@sha256:075e7733db357fe18ddd745372bbea44eaa854c60856c0bdb2a8442c88bc80f9",
        "attestor": "image://ghcr.io/krnl-labs/attestor-poc-realestateinvestment-dapp:latest@sha256:5ab93c9c06d64333ecd19a47bafc3348bb14e2b2ffd2972ab93044509fab1857",
        "next": "target-calldata",
        "config": {
          "rpc_url": "${_SECRETS.rpcSepoliaURL}",
          "target_contract": "{{ENV.TARGET_CONTRACT}}",
          "function_signature": "submitPropertyAnalysis((uint256,uint256,bytes32,(bytes32,bytes,bytes)[],bytes,bool,bytes))",
          "sender": "{{ENV.SENDER_ADDRESS}}",
          "sponsor_execution_fee": true
        },
        "inputs": {
          "result": "${construct-property-analysis-evm.result}",
          "executions": []
        },
        "outputs": [
          {
            "name": "nonce",
            "value": "nonce",
            "required": true,
            "export": true
          },
          {
            "name": "expiry",
            "value": "expiry",
            "required": true,
            "export": true
          },
          {
            "name": "id",
            "value": "id",
            "required": true,
            "export": true
          },
          {
            "name": "executions",
            "value": "executions",
            "required": true,
            "export": true
          },
          {
            "name": "result",
            "value": "result",
            "required": true,
            "export": true
          },
          {
            "name": "sponsor_execution_fee",
            "value": "sponsor_execution_fee",
            "required": true,
            "export": true
          },
          {
            "name": "signature",
            "value": "signature",
            "required": true,
            "export": true
          }
        ]
      },
      {
        "name": "target-calldata",
        "image": "ghcr.io/krnl-labs/executor-encoder-evm@sha256:b28823d12eb1b16cbcc34c751302cd2dbe7e35480a5bc20e4e7ad50a059b6611",
        "attestor": "image://ghcr.io/krnl-labs/attestor-poc-realestateinvestment-dapp:latest@sha256:5ab93c9c06d64333ecd19a47bafc3348bb14e2b2ffd2972ab93044509fab1857",
        "next": "sca-calldata",
        "config": {
          "function_signature": "submitPropertyAnalysis((uint256,uint256,bytes32,(bytes32,bytes,bytes)[],bytes,bool,bytes))",
          "parameters": [
            {
              "name": "authData",
              "type": "tuple",
              "components": [
                {
                  "name": "nonce",
                  "type": "uint256"
                },
                {
                  "name": "expiry",
                  "type": "uint256"
                },
                {
                  "name": "id",
                  "type": "bytes32"
                },
                {
                  "name": "executions",
                  "type": "tuple[]",
                  "components": [
                    {
                      "name": "id",
                      "type": "bytes32"
                    },
                    {
                      "name": "request",
                      "type": "bytes"
                    },
                    {
                      "name": "response",
                      "type": "bytes"
                    }
                  ]
                },
                {
                  "name": "result",
                  "type": "bytes"
                },
                {
                  "name": "sponsorExecutionFee",
                  "type": "bool"
                },
                {
                  "name": "signature",
                  "type": "bytes"
                }
              ]
            }
          ]
        },
        "inputs": {
          "value": {
            "authData": {
              "nonce": "${prepare-authdata.nonce}",
              "expiry": "${prepare-authdata.expiry}",
              "id": "${prepare-authdata.id}",
              "executions": [],
              "result": "${prepare-authdata.result}",
              "sponsorExecutionFee": "${prepare-authdata.sponsor_execution_fee}",
              "signature": "${prepare-authdata.signature}"
            }
          }
        },
        "outputs": [
          {
            "name": "result",
            "value": "result",
            "required": true,
            "export": true
          }
        ]
      },
      {
        "name": "sca-calldata",
        "image": "ghcr.io/krnl-labs/executor-encoder-evm@sha256:b28823d12eb1b16cbcc34c751302cd2dbe7e35480a5bc20e4e7ad50a059b6611",
        "attestor": "image://ghcr.io/krnl-labs/attestor-poc-realestateinvestment-dapp:latest@sha256:5ab93c9c06d64333ecd19a47bafc3348bb14e2b2ffd2972ab93044509fab1857",
        "next": "bundle",
        "config": {
          "function_signature": "execute((address,uint256,bytes32,address,address,bytes4,uint256,uint256),bytes,bytes)",
          "parameters": [
            {
              "name": "intent",
              "type": "tuple",
              "components": [
                {
                  "name": "target",
                  "type": "address"
                },
                {
                  "name": "value",
                  "type": "uint256"
                },
                {
                  "name": "id",
                  "type": "bytes32"
                },
                {
                  "name": "nodeAddress",
                  "type": "address"
                },
                {
                  "name": "delegate",
                  "type": "address"
                },
                {
                  "name": "targetFunction",
                  "type": "bytes4"
                },
                {
                  "name": "nonce",
                  "type": "uint256"
                },
                {
                  "name": "deadline",
                  "type": "uint256"
                }
              ]
            },
            {
              "name": "func",
              "type": "bytes"
            },
            {
              "name": "signature",
              "type": "bytes"
            }
          ]
        },
        "inputs": {
          "value": {
            "intent": {
              "target":"{{TRANSACTION_INTENT_TARGET}}",
              "value": "{{TRANSACTION_INTENT_VALUE}}",
              "id": "{{TRANSACTION_INTENT_ID}}",
              "nodeAddress": "{{TRANSACTION_INTENT_NODE_ADDRESS}}",
              "delegate": "{{TRANSACTION_INTENT_DELEGATE}}",
              "targetFunction": "{{TRANSACTION_INTENT_TARGET_FUNCTION}}",
              "nonce": "{{TRANSACTION_INTENT_NONCE}}",
              "deadline": "{{TRANSACTION_INTENT_DEADLINE}}"
            },
            "func": "${target-calldata.result}",
            "signature": "{{USER_SIGNATURE}}"
          }
        },
        "outputs": [
          {
            "name": "result",
            "value": "result",
            "required": true,
            "export": true
          }
        ]
      },
      {
        "name": "bundle",
        "image": "ghcr.io/krnl-labs/executor-data-bundle@sha256:a1d98f6e2e5ea1b4ca326dbdf85033d31f6ee8db930f0593e3bb9c5ff905a982",
        "attestor": "image://ghcr.io/krnl-labs/attestor-poc-realestateinvestment-dapp:latest@sha256:5ab93c9c06d64333ecd19a47bafc3348bb14e2b2ffd2972ab93044509fab1857",
        "config": {
          "chain_id": 11155111,
          "sender": "{{ENV.SENDER_ADDRESS}}",
          "bundler_url": "https://api.pimlico.io/v2/sepolia/rpc?apikey=${_SECRETS.pimlico-apikey}",
          "paymaster_url": "https://api.pimlico.io/v2/sepolia/rpc?apikey=${_SECRETS.pimlico-apikey}",
          "rpc_url": "${_SECRETS.rpcSepoliaURL}",
          "entrypoint_address": "0x0000000071727De22E5E9d8BAf0edAc6f37da032",
          "target_contract": "{{ENV.TARGET_CONTRACT}}",
          "function_signature": "execute((address,uint256,bytes32,address,address,bytes4,uint256,uint256),bytes,bytes)",
          "gas_limit": "100000",
          "max_fee_per_gas": "20000000000",
          "max_priority_fee_per_gas": "2000000000"
        },
        "inputs": {
          "calldata": "${sca-calldata.result}"
        },
        "outputs": [
          {
            "name": "user_op_hash",
            "value": "user_op_hash",
            "required": true,
            "export": true
          },
          {
            "name": "status",
            "value": "status",
            "required": true,
            "export": true
          },
          {
            "name": "error",
            "value": "error",
            "type": "string"
          }
        ]
      }
    ]
  },
  "dapp": {
    "name": "real-estate-investment",
    "targetChainID": 11155111,
    "targetContractAddress": "{{ENV.TARGET_CONTRACT}}",
    "targetFunctionSignature": "submitPropertyAnalysis((uint256,uint256,bytes32,(bytes32,bytes,bytes)[],bytes,bool,bytes))"
  }
}